//
//  PQCgenKAT_sign.c
//
//  Created by Bassham, Lawrence E (Fed) on 8/29/17.
//  Copyright Â© 2017 Bassham, Lawrence E (Fed). All rights reserved.
//
#include <stddef.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>
#include "rng.h"  
#include "sign.h"
#include "speed_print.h"
#include "cpucycles.h"

#define	MAX_MARKER_LEN      50

#define KAT_SUCCESS          0
#define KAT_FILE_OPEN_ERROR -1
#define KAT_DATA_ERROR      -3
#define KAT_CRYPTO_FAILURE  -4

#define NTESTS 1000

uint64_t t[NTESTS];

void
fprintBstr(FILE *fp, char *s, unsigned char *a, unsigned long long l)
{
	unsigned long long  i;
 
	fprintf(fp, "%s", s);

	for ( i=0; i<l; i++ )
		fprintf(fp, "%02X", a[i]);

	if ( l == 0 )
		fprintf(fp, "00");

	fprintf(fp, "\n");
}
uint8_t* hexStringToUint_8_a(const char* hexString) {
    size_t len = strlen(hexString);
    size_t arrayLen = len / 2;
    uint8_t* byteArray = (uint8_t*)malloc(arrayLen);

    if (byteArray == NULL) {
        return NULL;
    }

    for (size_t i = 0; i < arrayLen; i++) {
        sscanf(hexString + 2 * i, "%2hhX", &byteArray[i]);
    }

    return byteArray;
}


void messageGeneration(uint8_t* msgs[], size_t mlens[]){

    for (int i=0;i<20; i++){
        mlens[i] = 33*(i+1);
    }

    const char* m1_a = "D81C4D8D734FCBFBEADE3D3F8A039FAA2A2C9957E835AD55B22E75BF57BB556AC8";
    uint8_t* m1 = hexStringToUint_8_a(m1_a);
    msgs[0] = m1;
    const char* m2_a = "225D5CE2CEAC61930A07503FB59F7C2F936A3E075481DA3CA299A80F8C5DF9223A073E7B90E02EBF98CA2227EBA38C1AB2568209E46DBA961869C6F83983B17DCD49";
    uint8_t* m2 = hexStringToUint_8_a(m2_a);
    msgs[1] = m2;
    const char* m3_a = "2B8C4B0F29363EAEE469A7E33524538AA066AE98980EAA19D1F10593203DA2143B9E9E1973F7FF0E6C6AAA3C0B900E50D003412EFE96DEECE3046D8C46BC7709228789775ABDF56AED6416C90033780CB7A4984815DA1B14660DCF34AA34BF82CEBBCF";
    uint8_t* m3 = hexStringToUint_8_a(m3_a);
    msgs[2] = m3;
    const char* m4_a = "2F7AF5B52A046471EFCD720C9384919BE05A61CDE8E8B01251C5AB885E820FD36ED9FF6FDF45783EC81A86728CBB74B426ADFF96123C08FAC2BC6C58A9C0DD71761292262C65F20DF47751F0831770A6BB7B3760BB7F5EFFFB6E11AC35F353A6F24400B80B287834E92C9CF0D3C949D6DCA31B0B94E0E3312E8BD02174B170C2CA9355FE";
    uint8_t* m4 = hexStringToUint_8_a(m4_a);
    msgs[3] = m4;
    const char* m5_a = "1CDF0AE1124780A8FF00318F779A3B86B3504D059CA7AB3FE4D6EAE9FD46428D1DABB704C0735A8FE8708F409741017B723D9A304E54FDC5789A7B0748C2464B7308AC9665115644C569AE253D5205751342574C03346DDDC1950A6273546616B96D0C5ECE0A044AF0EDEFBE445F9AE37DA5AFB8D22A56D9FD1801425A0A276F48431D7AF039521E549551481391FE5F4EBFB7644D9F9782D83A95137E84EA3AEB3C2F8099";
    uint8_t* m5 = hexStringToUint_8_a(m5_a);
    msgs[4] = m5;
    const char* m6_a = "DBE5B6C299B44F8D60FA972A336DF789EF4534EC9BA90DF92AD401D1907951EB6285EDA8F134277AB0A1145001C34E392187122506AA2DBB8617D7943A129EB5C07DF133D7CCDE94A7CB7F1795C62493ED375353D1F044257DA799F7D112C174FBC35687E2F87FEFBE2D83D29D7314B30A749FE41B1B81095638F112BC4563420AF235280E466FFBE7050C4937C60FC18D1A6025BCBD489F0C538E088E906ABE8597E2C8EBB64F01D225C847AAE4B77BAE6EBA9269962C4B94A9732CEAA2CB4093D442FFBCDD";
    uint8_t* m6 = hexStringToUint_8_a(m6_a);
    msgs[5] = m6;
    const char* m7_a = "0073BEE97FC97C0FBC750D474AEB93189F061E1A5CF6600C04FB0464338EC7E85252F94FCBC7B2BD00E438480D9AF3ADD92A92E3E2E8ACB55077C3278FC7503988A76E9B6062996B20889AA55B343D5A003C8A8852D738F955799FA3426BE5CCD3AA6B6EDA04D4884941FFC0B69C5ACF12B347A74D0580CC3335BA816200F87674A4C1D98097C70F2F27C74E94A661850610ECF4847AB5B58344F958C5719E06BA396225BBE21ACB0FDC512B885D391E11B0C0ED5CE6B5DD8FAFF91F50025C69D43072F7706D80D9FD786E1104125D79A5F4B5FD838815D44FC8B1AB678078CC174DDE970D448B";
    uint8_t* m7 = hexStringToUint_8_a(m7_a);
    msgs[6] = m7;
    const char* m8_a = "A1586245D81F96BD8EE81AA30F10C0ADB343D74CF72C4DFF71550C12873AF89FA1874D4731C996243C3749AF3F6188FFE9FA45430549045134EB29EF3CEC37E72904AA082B1C6161E6B52361E49AF4933A8D8C0734F21CAFD7467B0C02876F43211D6122E3E735FE36064DF7A0C91449237C2BC7C3A78AC7BB0F9567F2576F05802C872ADF183A87AA3B8217188F2F3535F877724F35B29E545DE4BCF258F13BBC7EDD8C6587F733C9691F74B4151CF8C060C3AE9E8D49FE7C77BF477DC9F23FD0F0B67320275529034B84F94176730923C03AA50F9584D9C2D60B8DCCF85A13F243F30A51ABEFBBF2CDA602BF3D75E849EB92422B808416C7E56B046CE38E4677AD24D23D7237A9";
    uint8_t* m8 = hexStringToUint_8_a(m8_a);
    msgs[7] = m8;
    const char* m9_a = "9366ED7B3B623C411448B634446F1A3FAABDD163A6CC1E2BCAE4A98703CD8CEE441405892FBA051BE2A586A6950A5EF73A255E5F86B0D7212E0C51C3BC79BE4B88E76ED6F043FEF3204FAF044BFB1ED722D61EB5D0B74C66A257E8AC3A2206273C80D2EC2123A4DBB715D60118D99ED7322E38F1562F82379138DA3DDB8BAA7CE61AB729AFC3748C0134633CF45A9973C05C75D04E82F631845427626B5799DC07DDF830BA01E8BC6236BB6D03B37D949DBB29EEC7DFE60FBC17EA590956D251539792016E2A8B01E70476961BC9ADA43CDA682D0CAA4FCC58810BBA1A673EF8F6BC90BAEE701E8E4F7C04A346CA56C7B2862FF57756CE6CD1EE22D677BCDAA896EAE96F87870E032C18B6C6A0C1A191FAE2ED487CE55296CC4B6339EAC9E8A742BD0A44C3525CC750";
    uint8_t* m9 = hexStringToUint_8_a(m9_a);
    msgs[8] = m9;
    const char* m10_a = "0998114C84F84080E7EEBB47D248980FAC9D28F1ABB6DBAB3DD59A5CFD2C7CFF7F308372874DD5447C7B02E30165501C0C673128E4C543A414222BDF47E7F4E8DCA757B0F4A3281C0D10C4F02AB52AAF5B9A715E012607BA310947A60A5F62D6B8CFA96386D27CFA709189202421C078934AA2D955468E550AD4D0D4ACDD98B168A9568E232192E92789830317FBC959087FFFE353B6C168F3EFBE7164444F1D6CBA5246E31658C65440A841DBA78257E78502843EC1A6E9710229C8EEB85D6CDDC7D543285624AA1F756A5DD4F1A5D4FA52DB8C5C34880ED448FBB6D254509FBEEA0FA022F276B6A66BEF7ABFEA6049FF74291BABE781F718683397077B29FA9E2B46BC6B09251E587CC5B182195DD4060CC4A319BFBE251A5B660A739DFE5D0E5B93F3CB7E440194F1C8BDA922CB1A3EE3D27EDFD61C1D31A7F4534E84889EC83B51F1641892766434";
    uint8_t* m10 = hexStringToUint_8_a(m10_a);
    msgs[9] = m10;
    const char* m11_a = "4CCA95CB9F254C2EAA7DCFFEF662EE03320D5FC626A6484304BF62FC20F341FBE26E1537D7BD20E95440F7CC95EE84E1297C807A0BC9006DFCD5C22A5C1FC0865F5D70E5D63AD677FFFDEA52BF85D1A4F159F7ED16A745B4D971B620048B5F518EB2DC672CA35022578059E1ADAD7C07FE910A5D566B8321D9A12F34C250BE35CE964DDDEA23C90EA77C9C1BBE3532FEEFDA3637157786EC7D37775AE5CB0BB92EAB45A0FB1E833E8A6F3D06B85946E31A79B64A02B31FA640ED514A85882C89F693A06354DFDDB0B5E23E7792134C69C1D3908882DF3A7694A05B241B87FB2DBD1A4D9F26943B69F3CDF730301663089D1EBFC23299DA21300F735CEDF7B109F3E0BBE273776E6AAFA7054A6CD9682B967EB7903DE549E9558E62DCF3AC444DD7042FEA362EFB555BB97FB464AD7FAEABA3197C14A6740477DB50CE3FB8B762F48F880381D510FCC836E5880B48F08BD6333202E838AB73F2E106CFBFB218AAB802DA8A00F13F78FFB70C";
    uint8_t* m11 = hexStringToUint_8_a(m11_a);
    msgs[10] = m11;
    const char* m12_a = "5C4B2E1A344DA1418B0F4BE3FD99505FC30F2A1E5B696E943BEE2451D7B268F722E04F8E00FDD9E1A470F8C977A6D45A5F621B8815E352FA14F64977D1FA08082A48AF495719EA6AC1C0B3D898603B4CF7EC88E68DD7190884382896D953D612CC21ABECFB01A04A1BB1BBE8986D34625756396CCD84BD1A6B5454DDA98824CD4844D98F356AB485EEB19F9196ABB1C3088C0C3C5846C88760B696D91A232D6F4CFFC85BFF33DE1A3433A27A209A461FCF37F2289F98BEA7CCF183DB1FC42A7EDF958E7913F8711DC375E43F09BE7C7A2C2B1318AE2A9CF5988FBC2CE0735A2CD9FB6C8496C34406C538C01BD494193240BFF947FED47B7CCE99A1747973F1FAA5223AC564BBA0CA8973D1310B5BFA1452CACE9110BC22A8D4080A8BAAA8ADFA3CFB6685679B648484E3A43F9B1B2531949BBB8FAE1846F6D45D9272FC2CAA2913B5D9F8D322E9B18A685122D74634C60730C101578BEF2480711FEFFE02123E76D6C846559E2EA99A98923EF095630102A5573EF027E0AB6E52555A9EDE0D15A73C8B2FEF87CA6FD9F903F0";
    uint8_t* m12 = hexStringToUint_8_a(m12_a);
    msgs[11] = m12;
    const char* m13_a = "49755A7B1A7CDC5C9BDF5149968061D3C95EE67BFBAF02750C45094303A9D9CD23A08F19B9C768ADC63FFD1527186D09CA4E0356BB882E263BF015CBE3716C05B31A69DDDB790BA82C341AC9B6BE68A81B8BEF8D882304BAF0020D761A0DB04412033DC369961A5213B04E81736A580F1162780599CC029E262D67F31B2773AFB457A1ADAAA292163144F17DE384234F3303111FCD89BCB30333C6C6486F775ED099043C34E6C86450B650F1A02D03781B1D20691B767D166DADF1DCC4D8604D976EFDC9168373A7316DDA9B9FB02A4A321218D9F54E287B7167A08BC0153843BD6355AEA1310824DD5D5EC458BE694AF176119D9E588A29C650FF5500293659EA478B39A62149F819CDB7E7CB32E1D7B1284F159E2AB1B1EA41AF4D0AC94FF3111FC1CCD818F9B2CC7A259701405FDF6A51D2D3EF62789297BD16A659F14968EF902C4A23DA409BF13A4913467B5C991854B2CA6CC006D3F4197A6AA58BD5DD95C36928DA9583332C3FB134FA3890FE7E299F1C17205366C4F4230724C43E4803912E72B816658BBB1B63780865A1F66A2A49B96E93711B1BE97B827D12173402828B1A065B94310D5BD6098D";
    uint8_t* m13 = hexStringToUint_8_a(m13_a);
    msgs[12] = m13;
    const char* m14_a = "439529DF1864297E33956AFEE00A60099B658A67830A6A6ABDDC329E87831D9F9B647917FEDF1AE182A40402143285516FCAB83F447354C72FAE81AC26E7005C2AA561763C152E66BD80F14565F47DEFA440DBB491E7994AB9FE35995D5FBB3800CA030B43DF611141637A5246AB9D9CAC02EFE14AF60736B6BDB2BABB97CF21E831E5D04D41C00F090B154977900EFADD3A9313389A3F84CB3AC38E8B57B70A43DD08A8243F8154013FD5CF29DE5A8DF0B197C12B17E0610FCFE3625CC94067E01E23D23A243AD1C1F805CC50E1447D1DF93C25B8D76396BB7199E64129522462C5FC8B30C132D4EE9E0BF6F52961FCE7ECF650647E7064AA5A6574649A323E144D7C5491DE4C0A1A76D08F93F87A2FC7F6955FEF86991E62E2CB42908E83B0C0A8BC180B7453CED293F1E20F300431EC1D395E8A537F0BC36A673D491F14381DEA90D8F176D06031B0A7AFB40EA8F76D37FA82E2572B9799A5FC7CF4C49BC20AD78EFA8CD989A84D72ED680AC3C0F64155C56ACBFD7C7D628B418A489F961357F77BD62204ADB079DD3106485A37FEE535C9CF82E832D8AADCBF686976B806B02AE733DB46DB0BF162E973931C3E338CC86DB38C66262D1B2EBC7691B8281E0B20BF36305FBA996D20ECFDC695";
    uint8_t* m14 = hexStringToUint_8_a(m14_a);
    msgs[13] = m14;
    const char* m15_a = "8CB18850E27D8416B88A9A71F4A66BDF447814DB6C82098C371B53F61600EF5DFD88E4FB34200207C3F6F55166AF4878D38FCA7E2DC18FE662E3EA491B58A86246CAE16090FB7ADA53B9A67B3D0E3787D3323EA921274C60CFFB19A889BCF0300FE10E242AAE025F374DD83FBE9D007C8B9D9D75574C74146331DDEC6F0E49C10DBAF15654897E33E2B4780DBA484224AA6FAC79015D5792FAA2D532BB7D239B11D91420B98690B1FBDE9632223927E0804BFB284368A426C414C3DB8EA82F0D246413861475ED2DCA9E80FB4F3C34FEF7528069AE1975AFC52AC5AD2CDBCA1459E140F655556093210D7905A1A1E6CEEAEF0194A0B2EAB2C1EE853484E715D2A1DB551FDC620D5331164C74CA4848B61D408D2F2A943FA09EFEB63D524691C99DCC0B22CC61B98E6FB8039E5E0B2D7DE2CAAA900A44184BD56C9F02141A3AE8AFC661E3E898ECD3004FDB0704272BA780CD5DE35153B6FE223843024273642DCF8E4B58BE2AB1F61668680084AA0B75A32E766C8AE5EB30D4E02A12E6798DEA40F80D8DDFAD2041A52922701C689F46F49F84CFC05ECA6D7D4C356D50B6A0BA61966245D45134D6A1F5197540A1C39C36BB0B78831AF3F5156E669FD9213B64E0CF1C5A31E88AE79AD61757EC67B551B9F0A760F646BF81F6B92403A62840CC29FA4F3949B3A9F0A9A4286EE7808A";
    uint8_t* m15 = hexStringToUint_8_a(m15_a);
    msgs[14] = m15;
    const char* m16_a = "9B64813C058F07A09A796FD764604EAF58CE144363702896DF0AB5FF26D5DE000D14BB8FD358FF5532D3B909AB62C18AC30F1900F84EBD3F4F18BD532D16C7B3470F0F8BDF72938C916DB18BCF1429DC1635B1C152C5F89A9EDB17116C11815A6C06273A889132923DA908FF39F4940A840D3CB575DC4D637AAFD37968EC61FC4EA04B4C320491A73ECFBDD8E10F1DFE902FCCEF93DD287ED872F67146BB8CA5A6ADCF0350E8BBA7F2F9762C4AA748FCE19748EB17334146C152FD63FAE3DFBB1A2C2B3C78960369551FDAC5D54643BEEAA59C1FEB0C21DBBB19977D848CD82A7AE0005F45956E0FE4700F14FBAA0C12FB8C65A6AEC95C5A5C8E79A6DA9C4E446872575C06AE49A31B82245E1757C7CE84D6D5DF3F642D3434B7E1A15A8B8A9DB460826B6CDCA69022DBF87595B582DDBB90A81E09A13C2AB1C125E4435FF30ABC9C56A00EDFA979F79D9C895E800D2DD6372FAE5FAACD83ADF8A6D55279D52DF547E9BAB39D99076AD7D297371344D35BD584E0FB5932F92FD5183B9250CD180FC645BEF6028C405B0EF35DAF783428173F1F2482AA1363640F66AF0FE8ECACC0DAB84ABD2A1FB53AF44445698CF1DDF4C2EA214DD339BE004E75BF76E95CA5C16981ABA5540689C1C1F1DAF4D0F89D62CCB3496340D61E7D5F5156FD3EDD02EDFEC8FCDD0B231697B0E66F4A3AAF46117532F5EE2CB4D2B3B82B0BEAE0A45A482CE9A976CC99AA82BEB0FE08CB68C4";
    uint8_t* m16 = hexStringToUint_8_a(m16_a);
    msgs[15] = m16;
    const char* m17_a = "922320F7439E492F13C272A5738FF7122DD7A6B2832632E1F7A653FEF3B8639BCB9E84F482F22A948EA17DDE6958489593D2CB268BB52DF8ED612F2317BD6847D1622CF0532CB499ADC432233B93B6F7B1866B38975AC87859AC49F91E8D235846775F9E6E6D052339C741EF6178016EDB3D0B1E3F3536667B3EA2D489F88D254B8582421A31461374F465D7AD62E896BE0857134707A70477FABC09FE0A5CC3B3F32911F5FF3806B878205525AF69007F50535DF05C33AF3B0D00E297AC7EAA012E1D863DD5DD5FA47FB09467DBAD8BC42EDBAB42A9625BFDB9FE578343297506A3B71CDC8D5919955AF4605FCB0C7164D96A187AFF65D0F6210FEF2D11BA08D90C4458542BE72E084577BE9E451B8B6F4909884BCC5D25316ADCCD0925664D4D91C2E56433C1B68C632B0CA56D856DF1EDD5E113D1F026B30DAC4FD648A504F8F6809C701C97BCAC2B99286CEF5C1C923200B1BF6141EE1CFC51C5E14554BC02D7E058970254D2C02948360ABC4DFB439E66946A8AD615147BD8A6CB0886211E8B15DFF3C72B6F8908CE56BBC1B40E838103202E9F188D98E07555DB61778F895F76FBD838B6D14209D28EB393668924AC0E61072CBD9F93B864904FF4302DCEA131B2CA16BB04959ACEE096B1963CE07F59AB505FCC8D89FE08FC58751965F2F5CA753D76D58705652D3B1505E0F720EDE3142DE9776FFE4AA0C8A25E76C7A04843377C59F1002844E89189E22F621467B813A98BF07540A1649264F14A6844D65692617F7A4D93FA9A23829E256626";
    uint8_t* m17 = hexStringToUint_8_a(m17_a);
    msgs[16] = m17;
    const char* m18_a = "576289D10AB03D5699EAC322D349F55C547101E4424BFA43BBBA3747B79F075AE1153A7A0AC8BB51D24FC46B7604E42EFE4343FA34AA4EB16D918F25E8A4D67C860CCA3F7480E1221ED3AE13A138F079FC252C6D7BEBC55CB81B86E74F339614BEBCF7E8F4440DF8678B01A4A41B3AFB1D112FE1C4C8D8C6BFE9D3EE2A335D477C60FBF43B2E5FFFE1546F5172EF51CFFB2A772E1575EAC79B24D49FD77F0BE351233E57EE6DCC7E2E29994873ABD434D34ACE83400C026E27E27888EA0BDD1BDE5A3E55AA8B5F2FEB57B8B0A96CD831906297C8169D04F15843A3249C50523CF56A4E19492EA16927DBA8759B88A99E0D20820E51FC9B6A6863115CF05C5BC3F4C869EB5A87124DF5DB102D737F3899CFAA5FEA4DD62DC4FEDB1AAFF67906ADAF8968020EFA5B10190F70E5F2C0F0457E4341BD449201D3A80AEB791254EC1C46DDCEBC3896C6DF702509BA62CD446D275806438EB4C03132B2E6BD01BD2F832D1D3C053C48C5A9DB1C4A22B130C4C9E96A2BF4C2A8F7DE0217A52D9AA5AEEE5E6A49708237EAB60B4019A51390C3EF10572A73D436875BB8D7D78543F96376E4BF3BCAABB92F89215E8D1093F3B287945708B5514BD7E62654D3BDF34B29009C64829A0CBF33C54D7AB0E81B81BDDA93028B341AB1DFF3D752DC4A1E5F9636A5C46E137EA35919D99E6571C5370C6E804BD2E2ABF566F035D65CF8F97E3E8F2ECAFA153BC6D8EC2831667A37FC96D1C2DA40BA84D0FB041DEF32AADAEF3F98CAFA957F6552F79D28A36B8BA20A9452671DE1BE8AF5D66714232507EDB9FF657F3D7E5FA7320FC0359A5F99280D446283BC";
    uint8_t* m18 = hexStringToUint_8_a(m18_a);
    msgs[17] = m18;
    const char* m19_a = "021E9C06A2E4EF63D1A61958620C40016783879080D44311E04F2A446BCAEE5A486D17FF0F356BA70FF1C2B55BF957A59202903AE349878CB822E04275E0AFAABC0803BB6CDE3741E0BF9FCE0C5D5C814977474533DC63F9ED4F32AC3477A3EC9893EF55186728C85B03F4C2E61CA7733E1706766AEB8FEA80E233E8761B57FD5A3CEF700196674B34A3A55F68B3368B688FB1DDC976FF48BA6A98E2D66023F291A3C617A56CCBDB8732B8C34369ED11F4CCEA8FC8F673AD9FA0FD8990BEF70AF44C617FDFA096695D0C94EA8E17554F4461DC776DB2F416448B17680FE4D29B09E57603D8EBF55771AF84D8D4B9097302901C25CB6D73932E67C323D12C8ACB0E74CB89755F7EB3999D4EAB5E1B775E6B5C29D9733697030A26F3B93B3F286DB0F2DBDA71E1F103878063E77919D8892EB6A34F821B603ED4A898A9F30D00FEEF20985FEF1A7B7AF70DD29C269E88687F005D551EF05EB0603FD38745AED4F5BF4C2FC09F0604C98AE3A89E46BBFE907B87A1672DE547D651F035F392A8D4DB5E7260F43953028E312B95B9F25FFF2C0C579218390411D13D9A25F22DE4C7AA05FD11781DB08977160D48E02372C7D826F5CAC37D1A9B4230BE99A2D13CC2E9B2B17F0A1044EB9E0A2FBA376D35CDD2BC05F57DCE4BBC3BF07A09BCDE369929E6250EFDC61689466B040AEA376B09453A2C16813BBB685B54A225C49008BA6811E8BB5B3627F8C281244FDF5533216D126ED0E64FDABEC533424BFF77FE722CC438CA7587C19D965F0BF085D8692C27C5C84A9DEE53256D978948D89ABDF9842E0B765BE6A507D8630CBC5CA7FA0FBCA1CECC78D2E536AA7B2B902C4379777AC0920D69C57CC4E6032252BDE99E1A555E80D4";
    uint8_t* m19 = hexStringToUint_8_a(m19_a);
    msgs[18] = m19;
    const char* m20_a = "7BEDAFEBABBBFB863CE496475F54E69A905AFA45899C3D7C16CFC73E31597D2404AE7014612E4CBFA238EFAF5B396B0B7435ADA5DE817E013188C280423C68924E1FA2A33CA56E6B85B7CCA7F00D3A6151F0629C1B92A13573320E0025863BBA7F3EEB987EE1B1A6230B10765DFC1FEEA498AE4B83521188E7503B506259103CEFB370E3651B06DD4F08013FF3AB9E2430626B0BD584232948462D85C0F82DA07B96FC65F62A43CD2F132D1A1D691C085980DAD8796CCE2FA0B268395EAC3DA2CC400F30F75BE87316216980CE213B48651DDB9E294F8CDB2CA05D3F2A507E4A03E2849AA8062918AFB5BCE9E4C3ABF2FFD4751DDDCF08AB09E36A29B830F3BAC6FEEBEA084575472E6F4B239AF89965A72954769A83E391DE467934237B07D8884A6B14CAD034FBF9BD7531D50D742E234E227E1A2DAF77A2FFACC579525134B15186D81AE6E5538871024BD2897475D6EE5B11BC51EDBB928D98475073785A75B331BF3D2297165AE6CF95C3A05F06DF747498462054F58A5AC736F96014B1A8CDB319D030D06DAD9CAB2B913F35FC392E1FC4B027CDBE775D64B04F1076A7C8F44C360745F98E87B84C18AB76F84F373F635AF4C8A87DF08DD4507899BAD892FF8CC1EE534D3277B5B82095628B84A7D5582149CF46C50AA963B56B4B91966B106B4B2EAA45D83A10993E8F933370AB29C6606B7CCFC41B21C6B99F2B9AC643E24300B350FA199EC10E64E4AF19181F78E8C43B2FA796241DC42CC8992BDFCDC39E7BC41BE68CDCE4FBC47C996DB42E8249EEDC146C216B514430C705FC939B9EEF677AD87F9CEE3398551FA0DAF774302324A410F4A4F4FC035CFBE960B38C390441E92D9E5624A8745976BC88FA538E398712361B77AD4CA5FF038D9F6CE157EB8A6137420D4E57018275DCEEBC4E480A5D";
    uint8_t* m20 = hexStringToUint_8_a(m20_a);
    msgs[19] = m20;

}



int main(){
    char                fn_req[32], fn_rsp[32];
    FILE                *fp_req, *fp_rsp;
    uint8_t             seed[48];
    uint8_t             msg[3300];
    uint8_t             entropy_input[48];
    uint8_t             *sm, *m10, *m9;
    size_t              mlen, smlen, mlen1,smlen1, smlen2;
    int                 count;
    int                 done;
    uint8_t             pk[CRYPTO_PUBLICKEYBYTES], sk[CRYPTO_SECRETKEYBYTES];
    int                 ret_val;

    // generate keypair
    if ( (ret_val = crypto_sign_keypair(pk, sk)) != 0) {
        printf("crypto_sign_keypair returned <%d>\n", ret_val);
        return KAT_CRYPTO_FAILURE;
     }

    mlen = 33;
    smlen=CRYPTO_BYTES + mlen;
    
    sm = (uint8_t *)calloc(mlen+CRYPTO_BYTES, sizeof(uint8_t));
    

    uint8_t* msgs[20];
    size_t mlens[20];
    // generate 20 messages
    messageGeneration(msgs, mlens);
    // batch sign message for NTESTS observations
    for(int i = 0; i < NTESTS; ++i) {
        t[i] = cpucycles();
        crypto_sign_signature_20(sm, &smlen, msgs, mlens, sk);
    }
    print_results("crypto_sign_signature_20:", t, NTESTS);

    // original sign message for NTESTS observations
    for(int i = 0; i < NTESTS; ++i) {
        t[i] = cpucycles();
        for (int k=0;k<20;k++){
            crypto_sign(sm, &smlen, msgs[k], mlens[k], sk);
        } 
    }
    print_results("crypto_sign:", t, NTESTS);

    // Example sm
    const char* sm1="DDB5270034BB65963086DA92EB836552A5332BF33C00D6E0E1AE5ECAAC7D1FA0EF3F9AEC08F90347DB8D866A1BC9931B72C27B1B2793982E0843A22EFC17C5A3791A4C141C6CDDF47C6E3E0D28D56848B14494E5A32CA6CEC0F8249638B9517759CEB622B315A24C879ACFAB413B3CE8F59251BCA92B3C9BFF925969E3CE8CC5221925EFFCBEEA738A92F6654D3E4993F0B540CACEAB422F9DA74294E4C150246B4BDC8F221C6832B88A024651EF6FF4F042B6E91414DFA591A340C470D09FCFA9A0ED2A54E5B55AE232A22791E7F83D333A798F1644C356DE2C8FFA9444AB33225CEC81E0ACA62838DF3CE784CC396A4594CB188617D567C47D9BDA8C9270909371F56528B38C7149771BA6C4BB42C66A734B2E4EDD0207EACBCE5AAD51FABD277E6213F0711D16B1590267A9C9F0859D77D92A567BF5B0CF5F78D113DE8DE33ADE2D7BFA1057CCBC3E98EE7916D9A2683C29368D8C1248008276CAA094BFE9EB3D0385C4E6B97E6C373EBD2D9C4F929CB7209AFA7E2E570B913B57515108FC5F1F68596AFBF859E2F51D451C5D1BCDF4EEC833E965CA0C9F70E4295C0D01680FA27B8293E8097597A2C276A14FB2B4741B36B6BC5CA7FEF2357B36AD48D17F7B239EBDFFD50447F04BC1477AFC125A4DA3DCFFF57452A62266382E684855538AEA4ABF7A0E68DA657D2CA297613DCF062F10F02E357B304C6D1C3ECB687024DABCCBCA90CC1D8437ADC78BE300089A5E299B12EB1EFD3A7CF97E52BB32FE2256728414AE68F87019DDA4738A4AEC4C31D1906B2A3D09DD51BC5FC9F123FF35DBCD2B69B00C18DE47C53EA8B45C83427F1864C7D154E74A74EA59F3969747ABCEF3346CDD1AC2AD5563AB738E3E92F919E4F5273C9A5CCC62A176B57A22FCCB632EF48DB9630C26F69B39646ACBD72A68DE9050BAB45B5D903A3D15512557EC4E0EFEF707D9F1BDE2F72BE53587690C7D7D3FCF2EE147CC7D471CA3A191C386CF8CE119DA61A662A38D658702C489AEAF20CF23117E926D49861113C39CE5B1D3B21FEAA98F3AC270D9ECF64621B619C5DA4DF815E0ED60B84E10715FD639BFB993387AAE79CA7FAAB40FCC7300EA4BE178FFF111C60A337112D0AA0D3EF6EA65B6BC3A442B1613349F6C11128A33D12AE6E36B61FC88EC4B54F71D882ADB0CE11971017B9147B512D7EA13D661A4F5B831610B543C67BF97213C3366581B03D6991747FA38AEF31FBBD1B010DB41C81AF7202599CDB4D58D49F1E76A6C50D7E13D7884BD63575884B1D9CC81C2512A613477F6C635E717EFA8F066ED7893482600323D5B34F16BF66B0E656B5DDDE890BE53E7523261BAF389AEE5478DD3BF864B370CE79DFD1E2CE63180072092713F19F5137E9E2A1DC9CDA5A91A63F7B797D89A74173F484FF646235FBC8B0E1154E359DC215BA9AE9957CC827F85ACD3E339E7FA57FE349F2125690E4DEB883A6AE3B8D08ECEC9BC0721CE177B398787C747DE89D3C8EDB082CB5D5F89D5F58A5CBB53E987AA2BC2EEBC8FAE54010254C756955F26F7EFBFA92D0EDF56971F68EA1442D46CEFFC0D2287B160B6D34C1EB5EAE9FAAE13A374A0490156CC05355493B2B0B05C5E937E830C3CB0F1149F0BDFA8CDE153EE6AEBE37DFEFB2EE0C98FCAC7232B0BC38E7306734F8C27262E762BAE6C0CDDBC4FB3363AF7AB99FDE1139118B2F4819EACB08991B28EBACE51981AE4F92190CC7F9D46B801B6E9AEAA8BB952A5BBED5AA240ADC24F8BBD4995D0E2EC54F0260CEEA52DD657434F6C11B1C552D033326A95E336EEA7BCD2085DF319F33194A4ACF79079C3675ACAEB3DE63EE57D3249ACCC53B5485B84F2B535A5CD8E70B8A17FD6E474F4552C030437715632E91A44FDBC646AFB11A3F2EE9ACBC26A7EA368492E73F3A303C9E51BE31C2088C8076759AC1BFDD6F62DFF8121F083EC04C407BC15F53E785FB2AE9C9205949C65DE475B0AB176D9F4BD448C1CEE37E34E1BA452BCC71F398FFAD571B967ED8321545FA8BAA801385613EFACBE0B7B12FB90F8BB2A74ECAC5BA6D0A6A20F49DAD7CF9F7EA6D47D7271F333892D72546409C24294681F6E7C4E426D8D119B571E2AEFF7B6F638EE879E6A1B20493B4F3681BDF79C0CCFC9AADFC66904761068B319FE0BF0540C269139CD6135D4A611013B78B3F02E19E000FB7425BB70D8C68A34A92BBABA7662DC52BD8D563735377DB1FC64BCE6190391AD15936ABF5DC2293149A7268A156E28E03F25E8796260CEB392BDF9D0D1EFB0040228668D639B1DFEB7BE2E41728B7E1A0D8BBF79CF1176FF368EA7D90F02329C9C176263BE80E1CE657F203CC455249F2AAA950C14B06DE29B443B221F6E78307836FB182F3842D2FD85B6AD62E236F1F75E2070D3AB734C5A663883BD82DFD780745382B11B2605151DD7FC52558BC3AF5DADF452A05675E764DFCA92CAC923C6714F90B5581D2A86DCF984F5438878F4320DB481AA1E773A7046DB1FE4A5964C608A1A2C7AEA7584D64845A5962E4821D7FC050CC2CE4DC84CC370CFEC2451A73F3EB6ED1686F216C8693AF7EA829FEBD1B4AF9647FD7FA20F5957277BB9DC712A296E0908885F206B42A15DB319A685BC13DC08281655EF25EA15054EC578B4637CB8B945B483297EA2D7BA1B9FA68EDC";
    const char* sm2 ="B6BCAC8B13188C017B4A6A4FF1F90D7B5DEC4AC97D99A831C621AD503F9999F1A72437863811537533E7DA5B0BB4439642446BE30C809928AED5F02CD44664A16A200D6642C474A5D24B55B95DE094982D8011B4A2FC7A2737A6571BBAE14E2FD4E07F5193AB523FD61ACA882CAC1BD0D2D29921EC6307C7EDBE30E849184D00274ABF31445E83DFF28460CC52177EE6B6FA302751EF601140704CDED3AC534D15E195D43B65EF266BC91C0A05E79289DEA772F0FBEB773D4C67F51A62161A446A9E370E4619D897F2DA47A91DBD9073D39F4EB29B0053BAD3FD507E50ADB326DA2B39B40CAAC9443932643A71B3B83D4E957DAAF8E644F1EEC68485E83CAC6F72869ADFEA1048910BCC78CB73A43E207EC7412A649153A4A599B4A6C907EC0F85B54EE7C2931236FAB1164CD8F440C3D380B78EEA8C671515B43251EC4319C5ED58B0FD89C50AE9D69E5F34CD068007201930274B2D19F93F0F54CE217DEFD272FB880BE5B6A5861803E3836E52A9FBEAD38C0144BF5791112CBBE041E45E2651463881CA6715418C9DB95961F95D0206B6D7A79F4AAFD37B24A6106BD140F7880AEBB469B9C17500E454885C75497CBBE97C2121EFECA8B0A2C86BD4671A1C0E74D3BBBF484F83EB19662AD0E88EA2380EF4A738C148F2C698CDD59254CA1BEDCEA1C7010A14A3754EB85F1D949DF00818EA7B17A8CBD7B42FD47FFB94B31A5855943214FA5D0E9E6981562D9B14BFADED0F9548D91948D8BC91B2BBCCD3E1C05827C949475E679DD7E8CA716AC50D81248B2A6B5ADDD2E61A95E7B4CE7F2C1B2CDB804CFDE9FDAEF0650D62DB4683058ADB05942CE2BDE8C81AB1707141E39EF8C9ED23DE76D5546A780CD490645AAD88F77EDD27C6201B2F1922246C7808FBCB3BB77777F2D335D2E4BC0E13CCF6B45FCBCD76F3074D15FEC401FD3E03EC1858A07D9A28C0BE1E8637E3117C542F287726612B45B97DE93A446891CD115792411F311C233C9A27B9DDBC7E514AB3BFCB330E3992CF5C8191E87B27D722D3945F09712BB9F3765616243150FF25EBA158B7917477CA601B63D14F2114F9CC7142B49F678273848366631E80B8140A295ECFC43C0B22CD10B5310AA9C475EBCEFD142D5C966445A3005C845E5431587717B2540BE506A4EF2FFBE006F44569D19B88DBBACF930E1558D73F4A802E2F903E04C1AFCA2368072CD1EF1DD162F90B6932E5B13D4D1E4B40310C77D93B81090349F75D7B3FDBCBB0819F1FA39B53A503C82C5CE97728FFC9E12EF04A8D3FD59FD2C2661CE707F82A7EE279DB624B9C7766A28FD9D86B65285A17B131442FEF5950595D5556FBD38320A2478F951AEDBC112B51A740C6FC561B9EAA7DB596D80038F8CC1C9FA85076AF93D536D9D3B6C00713EE28CFD22816E2F83E308C6F2B18CFF71D670D3CF9468A8D48729E1142D149307A3E0C409D8C0540BF702FBCA0DBADA22DE17D595462D26844BC8F3F2CEBF6DFF1E3E865EAB68516BABA8D090F04A556E91D3F88143AE08F4233B5FCFFD6B97C25A78458CCD5463E5CCC65BC072E5F12C4A539703783A0F91D72CA6A650F49948164ABC45BC95229574061233E14D4F8E5DB3C55EBE9B74681C0FAEB777A709E7661AB690E6877923919D3998428FF2AAF60B2D82FCD5814D005278A3FA8B6B38AB14F3D5366BB382A1BB454BC3E0C955AAE10AA78458C3C04A1CFC037481BA169D9E48BFBD5822DEC3A9101E4D96849ECEC105EC368C311184874E933D896A7CC76CAC623A4EF29A1E92B732DEB755972462F0AF9DBC186D2AB6CEDC84151DD8941AE7AEBDFB0C0D0740C5AAFD0E0C99AFEB79F8AD5F6F292A336D3415582BBD3336F5F59D6DD2D4E5CD806762B4C6A2BDD476034ABE171DC32F06AF65BFB0D124EDAF91C2B4D6FD91F40606B747FA3B5258D9F3CA0ACC1C7E62031939B9F0000000000000000000000000000000000000000000000050A12151B20D81C4D8D734FCBFBEADE3D3F8A039FAA2A2C9957E835AD55B22E75BF57BB556AC8";
    size_t totalLength = strlen(sm1) + strlen(sm2);
    char* concat_sm1 = (char*)malloc(totalLength + 1);
    strcpy(concat_sm1, sm1);
    strcat(concat_sm1, sm2);
    uint8_t* sm1_converted = hexStringToUint_8_a(concat_sm1);
    
    mlen = 33;
    smlen1 = CRYPTO_BYTES + mlen;
    m10 = (uint8_t *)calloc(CRYPTO_BYTES + mlen, sizeof(uint8_t));

    // verify example sm
    if (ret_val = crypto_sign_open(m10, &mlen1, sm1_converted, smlen1, pk) != 0) {
        printf("crypto_sign_open returned <%d>\n", ret_val);
        return KAT_CRYPTO_FAILURE;
    }

    return 0;
}